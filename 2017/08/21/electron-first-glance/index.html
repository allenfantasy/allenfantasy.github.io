<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Electron 使用初体验 · A Fantasy Ninja</title><meta name="description" content="Electron 使用初体验 - Allen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="https://github.com/allenfantasy" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Electron 使用初体验</h1><div class="post-meta"><span class="post-time">2017年8月21日</span><span class="taglist"><a href="/tags/JavaScript" class="tag">JavaScript</a><a href="/tags/Electron" class="tag">Electron</a></span></div><div class="post-content"><p>关于 Electron 的流水账记录<br><a id="more"></a></p>
<h3 id="上手和使用"><a href="#上手和使用" class="headerlink" title="上手和使用"></a>上手和使用</h3><p>下载 <code>electron-quick-start</code> 仓库到本地，基于该仓库进行开发</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Clone the Quick Start repository</span></div><div class="line">$ git <span class="built_in">clone</span> https://github.com/electron/electron-quick-start</div><div class="line"></div><div class="line"><span class="comment"># Go into the repository</span></div><div class="line">$ <span class="built_in">cd</span> electron-quick-start</div><div class="line"></div><div class="line"><span class="comment"># Install the dependencies and run</span></div><div class="line">$ npm install &amp;&amp; npm start</div></pre></td></tr></table></figure>
<p>在 quick start 中，入口文件 <code>main.js</code> 使用了 Electron 的 API 调起了一个 <code>BrowserWindow</code> 的实例，并在这个实例中，打开了一个在本地的 HTML 文件 <code>index.html</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWindow</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// Create the browser window.</span></div><div class="line">  mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;<span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">600</span>&#125;)</div><div class="line"></div><div class="line">  <span class="comment">// and load the index.html of the app.</span></div><div class="line">  mainWindow.loadURL(url.format(&#123;</div><div class="line">    <span class="attr">pathname</span>: path.join(__dirname, <span class="string">'index.html'</span>),</div><div class="line">    <span class="attr">protocol</span>: <span class="string">'file:'</span>,</div><div class="line">    <span class="attr">slashes</span>: <span class="literal">true</span></div><div class="line">  &#125;))</div><div class="line"></div><div class="line">  <span class="comment">// Open the DevTools.</span></div><div class="line">  <span class="comment">// mainWindow.webContents.openDevTools()</span></div><div class="line"></div><div class="line">  <span class="comment">// Emitted when the window is closed.</span></div><div class="line">  mainWindow.on(<span class="string">'closed'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// Dereference the window object, usually you would store windows</span></div><div class="line">    <span class="comment">// in an array if your app supports multi windows, this is the time</span></div><div class="line">    <span class="comment">// when you should delete the corresponding element.</span></div><div class="line">    mainWindow = <span class="literal">null</span></div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来的事情就交给这个 HTML 文件了，你可以根据自己的实际需要随意编写，在 <code>base64-convertor</code> 这个应用中，我需要在前端展示一个 “一键转换” 的功能，所以需要一个输入框和一个输出结果的框，以及一个 “转换” 按钮。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"column"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">"box"</span> <span class="attr">id</span>=<span class="string">"input"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"convert"</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span>转换<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"column"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"output"</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>然后我们需要在点击转换按钮时，调用 <code>js-base64</code> 的 API 将用户输入的字符串进行转换。首先在 <code>index.html</code> 里面引入 JS 脚本：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 省略... --&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 省略... --&gt;</span></div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="comment">// You can also require other files to run in this process</span></div><div class="line">        <span class="built_in">require</span>(<span class="string">'./renderer.js'</span>)</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>注意到我们可以直接在页面内使用 <code>require</code> 方法，这个和一般的 Web 网页开发有所不同。在 <code>renderer.js</code> 里面我们编写实际的逻辑：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// renderer.js</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> Base64 = <span class="built_in">require</span>(<span class="string">'js-base64'</span>).Base64</div><div class="line"></div><div class="line"><span class="keyword">let</span> inputEl = <span class="built_in">document</span>.getElementById(<span class="string">'input'</span>)</div><div class="line"><span class="keyword">let</span> outputEl = <span class="built_in">document</span>.getElementById(<span class="string">'output'</span>)</div><div class="line"><span class="keyword">let</span> convertBtn = <span class="built_in">document</span>.getElementById(<span class="string">'convert'</span>)</div><div class="line"></div><div class="line">convertBtn.addEventListener(<span class="string">'click'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> val = inputEl.value</div><div class="line">    <span class="keyword">const</span> output = Base64.encode(val) <span class="comment">// 调用 API</span></div><div class="line"></div><div class="line">    outputEl.innerHTML = output</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>然后就可以了~~</p>
<p><img src="./electron-demo.gif" alt=""></p>
<h3 id="开发查看效果"><a href="#开发查看效果" class="headerlink" title="开发查看效果"></a>开发查看效果</h3><p><code>electron .</code></p>
<h3 id="打包-amp-构建-Installer"><a href="#打包-amp-构建-Installer" class="headerlink" title="打包 &amp; 构建 Installer"></a>打包 &amp; 构建 Installer</h3><p>使用 <a href="https://github.com/electron-userland/electron-packager" target="_blank" rel="noopener">electron-packager</a> 来进行打包，然后对应 MacOS 和 Windows 不同平台，需要用不同的构建 Installer 方法。以下操作都在 MacOS 上执行。</p>
<h4 id="Building-Mac-OS-App"><a href="#Building-Mac-OS-App" class="headerlink" title="Building Mac OS App"></a>Building Mac OS App</h4><p>这里我们使用 <a href="https://github.com/mongodb-js/electron-installer-dmg" target="_blank" rel="noopener">electron-installer-dmg</a> 来构建 MacOS 的 installer，其中参数的含义为：</p>
<ul>
<li><code>asar=true</code>：在打包过程中使用 <a href="https://github.com/electron/asar" target="_blank" rel="noopener">asar</a>，将应用的源代码打包成一个压缩包</li>
<li><code>--overwrite</code>：总是覆写原有路径上的同名文件</li>
<li><code>--platform=darwin</code>：构建 Mac OS 应用（若需要在 Mac Apple Store 上架则需要指明是 <code>mas</code> ）</li>
<li><code>--out=builds</code>：输出到 <code>builds/</code> 目录下</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 打包应用</span></div><div class="line">ELECTRON_MIRROR=<span class="string">"https://npm.taobao.org/mirrors/electron"</span> electron-packager . --overwrite --asar=<span class="literal">true</span> base64-convertor --platform=darwin --out=builds</div><div class="line"></div><div class="line"><span class="comment"># 构建安装包（Installer）</span></div><div class="line">electron-install-dmg --out=installers --overwrite ./builds/base64-convertor-darwin</div></pre></td></tr></table></figure>
<p>值得一提的是，应用的名字不可以超过 27 个字：<a href="https://github.com/LinusU/node-appdmg/issues/48" target="_blank" rel="noopener">https://github.com/LinusU/node-appdmg/issues/48</a></p>
<h4 id="Building-Windows-App"><a href="#Building-Windows-App" class="headerlink" title="Building Windows App"></a>Building Windows App</h4><p>在 Mac OS 系统上构建 Windows 应用，需要的步骤会更繁琐一些。<del>其实我觉得必要性也不是太大</del></p>
<p>本着尝试的态度，还是试了一下整个流程，这里仅列出打包 win32 的操作，win64 的并没有尝试。</p>
<p><strong>准备工作：下载 Wine, Mono</strong></p>
<p>在非 Windows 平台中，需要 <a href="https://github.com/electron/windows-installer/issues/112#issuecomment-229922112" target="_blank" rel="noopener">提前安装 wine 和 mono</a>：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">brew install wine</div><div class="line">brew install mono</div></pre></td></tr></table></figure>
<p><strong>打包应用</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ELECTRON_MIRROR=\<span class="string">"https://npm.taobao.org/mirrors/electron/\" electron-packager . --overwrite --asar=true base64-convertor --platform=win32 --out=builds</span></div></pre></td></tr></table></figure>
<p><strong>构建 Windows Installer</strong></p>
<p>参照了 @crilleengvall 的 electron 教程中 <a href="https://www.christianengvall.se/electron-windows-installer/" target="_blank" rel="noopener">关于 windows installer 的这篇</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node ./create-win32-installer.js</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// create-win32-installer.js</span></div><div class="line"><span class="keyword">const</span> createWindowsInstaller = <span class="built_in">require</span>(<span class="string">'electron-winstaller'</span>).createWindowsInstaller</div><div class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getInstallerConfig</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">const</span> rootPath = path.join(<span class="string">'./'</span>)</div><div class="line">    <span class="keyword">const</span> outPath = path.join(rootPath, <span class="string">'builds'</span>)</div><div class="line">    </div><div class="line">    <span class="keyword">const</span> config = &#123; </div><div class="line">        <span class="attr">appDirectory</span>: path.join(outPath, <span class="string">'base64-convertor-win32-x64'</span>),</div><div class="line">        <span class="attr">authors</span>: <span class="string">'Allen Wu'</span>,</div><div class="line">        <span class="attr">noMsi</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">outputDirectory</span>: path.join(rootPath, <span class="string">'installers'</span>),</div><div class="line">        <span class="attr">exe</span>: <span class="string">'base64-convertor.exe'</span>,</div><div class="line">        <span class="attr">setupExe</span>: <span class="string">'base64-convertor-installer.exe'</span>,</div><div class="line">        <span class="attr">setupIcon</span>: path.join(rootPath, <span class="string">'assets'</span>, <span class="string">'icons'</span>, <span class="string">'hiido.ico'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(config)</div><div class="line">&#125;</div><div class="line"></div><div class="line">getInstallerConfig()</div><div class="line">    .then(createWindowsInstaller)</div><div class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</div><div class="line">        <span class="built_in">console</span>.error(err.message || err)</div><div class="line">        process.exit(<span class="number">1</span>)</div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<p>如果在过程中遇到了 <code>spawn mono ENOENT</code> 的问题，就是没有安装 <code>mono</code> 这个依赖的原因：<a href="https://github.com/electron/windows-installer/issues/112" target="_blank" rel="noopener">https://github.com/electron/windows-installer/issues/112</a></p>
<h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><p>尝试其他 electron 的打包工具，比如：</p>
<ul>
<li><a href="https://github.com/electron-userland/electron-builder" target="_blank" rel="noopener">electron-builder</a></li>
<li><a href="https://github.com/electron-userland/electron-forge" target="_blank" rel="noopener">electron-forge</a></li>
</ul>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="https://www.christianengvall.se/electron-packager-tutorial/" target="_blank" rel="noopener">@crilleengvall 的 electron 教程</a></li>
<li><a href="https://github.com/electron/windows-installer" target="_blank" rel="noopener">electron/windows-installer</a></li>
<li><a href="https://github.com/Squirrel/Squirrel.Windows" target="_blank" rel="noopener">Squirrel/Squirrel.Windows</a></li>
</ul>
</div></article></div></section><footer><div class="paginator"><a href="/2017/10/08/color-notes/" class="prev">上一篇</a><a href="/2017/05/08/user-tracking-iv/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
    this.page.url = 'http://afantasy.ninja/2017/08/21/electron-first-glance/';
    // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = '2017/08/21/electron-first-glance/';
    // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
(function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://afantasy-ninja.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the<a href="https://disqus.com/?ref_noscript">comments powered by Disqus</a></noscript><script id="dsq-count-scr" src="//afantasy-ninja.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2019 <a href="http://afantasy.ninja">Allen</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="https://s22.cnzz.com/z_stat.php?id=1261988857&amp;web_id=1261988857"></script><script>document.querySelector('[title="站长统计"]').style.display = 'none'</script></body></html>